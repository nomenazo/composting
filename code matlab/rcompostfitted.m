clear;

%initialisation des variables
y0=[0.203655 0.049914 0.025361 0 0.001704 0.000159 0.010254 0 0 0 0 0 5e-4 5e-4 1e-4 1e-4 5e-6 5e-6 0 0 0.710953 293 0 0 0]; %O2init %kg/kgTM %2.6954e-4 
%Komilis
%y0=[0.143648615	0.032850215	0.009411529	0.011634545	0.033002892	0.025840144	0.012410308 0 0 0 0 0 5e-4 5e-4 1e-4 1e-4 5e-6 5e-6 0 0 0.710953 293 0 0 0]; %from the "Data for fitting en h"

%tspan(1)=0;
%for i=2:96
 %  tspan(i)=tspan(i-1)+24;
%end;

tspan = [0 5000];

options = odeset('RelTol',1e-12,'AbsTol',1e-14);

%options = odeset('Events', @events);
%[t,y]=ode45_with_corrections('compostfitted',[tspan],[y0]);
[t,y]=ode15s('compostfitted',[tspan],[y0] , options);




C=y(:,1);
P=y(:,2);
L=y(:,3);
H=y(:,4);
CE=y(:,5);
LG=y(:,6);
Xi=y(:,7);
Sc=y(:,8);
Sp=y(:,9);
Sl=y(:,10);
Sh=y(:,11);
Slg=y(:,12);
Xmb=y(:,13);
Xtb=y(:,14);
Xma=y(:,15);
Xta=y(:,16);
Xmf=y(:,17);
Xtf=y(:,18);
Xdb=y(:,19);
CO2=y(:,20);
W=y(:,21);
T=y(:,22);

CH4gen=y(:,23);
CH4oxi=y(:,24);
CH4=y(:,25);
%O2trans=y(:,24);
%O2in=y(:,25);

CCO2= (0.012/0.044) * CO2;

%y = max(0,y);
CH4 = max(0,CH4);
y(y<0)=0;

dataCO2= [0	0.010658307	0.012064092	0.020488396	0.023870271	0.030051839	0.032267393  ...
    0.034299089	0.038006534	0.039503369	0.040739904	0.042901283	0.044411015	0.045248496 ...
    0.047254084	0.048646905	0.049735599	0.049812045	0.051551822	0.051782538	0.053578481 ...
    0.054737495	0.05584828	0.056941472	0.057660209	0.058723218	0.059132392	0.059721854 ...
    0.060876461	0.062067494	0.062106234	0.062848158	0.063068093	0.063059189	0.063047242 ...
    0.063277004	0.063419717	0.063739185	0.06404356	0.064904292	0.065162834	0.064998938  ...
    0.066034943	0.06645967	0.066818461	0.066716552	0.067741576	0.068010284	0.067975709	...
    0.068245469	0.06884277	0.069147466	0.069376341	0.069798145	0.06985545	0.069630769	...
    0.070680557	0.070905549	0.070939253	0.070902227	0.071318185	0.071257984	0.071469734	...
    0.071710832	0.071979559	0.072027407	0.072160354	0.072529026	0.072921378	0.072858746	...
    0.073311255	0.073726422	0.073782105	0.073784744	0.073763294	0.073971598	0.073904728	...
    0.074438034	0.074721419	0.07484848	0.075038274	0.075373127	0.075577342	0.075553739	...
    0.075661505	0.075922374	0.075913674	0.075927796	0.07593392	0.076546655	0.076825088	...
    0.076796612	0.07708573	0.077181414	0.077353359	0.076898372];
%subplot(1,1,1);
plot(t,CCO2,'r-' ) ; %,t,dataCO2,'k.');
%title('Production of CO2');
%xlabel('time (h)');
%ylabel('CO2-C (kg/kgTM)');




%subplot(7,1,2);
%plot(t,CCO2);
%xlabel('Time (h)');
%ylabel('CCO2 (kg/kgTM)');
%subplot(7,1,3);
%plot(t,O2diss);
%xlabel('Time (h)');
%ylabel('O2diss (kg/kgTM)');
%subplot(7,1,4);
%plot(t,P);
%xlabel('Time (h)');
%ylabel('P (kg/kgTM)');
%subplot(7,1,5);
%plot(t,L);
%xlabel('Time (h)');
%ylabel('L (kg/kgTM)');
%subplot(5,1,5);
%plot(t,O2in);
%xlabel('Time (h)');
%ylabel('O2in (kg/kgTM)');