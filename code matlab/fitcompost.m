clear;
% S0=9.663 mg
t=[0 24	48 72	96	120	144	168	192	216	240	264	288	312	336	360	384	408	...
    432	456	480	504	528	552	576	600	624	648	672	696	720	744	768	792	816	840	864	888	912	936	960	984];

dataCO2 = [0	0.030825453	0.038069825	0.054948653	0.07457083	0.08570688	0.100401451	0.118543452	0.135975422	0.146154358	0.152217452	0.16051648	0.166380789	0.172417868	0.176910715	0.184742316 ...
    0.187609565	0.188741664	0.191862974	0.195344996	0.200357006	0.205940935	0.210422809	0.213240323	0.216394076	0.219748911	0.221979687	0.224193883	0.228225611	0.232231571	0.233427551	0.234536665 ...
    0.236583391	0.236792542	0.236792542	0.237443205	0.238141787	0.238394479	0.239642021	0.242166207	0.243471514	0.244584];

 %dataCO2=[0	0.030825453	0.007244372	0.016878828	0.019622177	0.011136051	0.01469457	0.018142001	0.01743197	0.010178936	0.006063094	0.008299028	0.005864309	0.006037079	0.004492846	0.007831602	0.002867248	0.001132099	0.00312131	0.003482022	0.005012011	0.005583929	0.004481874	0.002817514	0.003153752	0.003354835	0.002230776	0.002214196	0.004031728	0.00400596	0.00119598	0.001109114	0.002046726	0.000209151	0	0.000650663	0.000698582	0.000252692	0.001247541	0.002524187	0.001305307	0.001112485];
%CO2 values at t

%bd0=[0.03 0.02 0.01 0.015 0.01 0.01]; %constante de décès de la littérature
kh0 = [0.04 0.02 0.01 0.02 0.04 0.01 0.009 0.007 0.007 0.009 0.007 0.007]

LB=[0 0 0 0 0 0 ]';
UB=[inf inf inf inf inf inf]';

[kh]=lsqcurvefit('rcompostfit',kh0,t,dataCO2,LB,UB)
yfit=rcompostfit(kh,t);
CO2fit=yfit(1,:);
%nP=Pfit-dataP;
%nSt=Stfit-dataSt;
%dP=dataP-(1./10).*sum(dataP);
%dSt=dataSt-(1./10)*sum(dataSt);
%R2P=1-(sum(nP.^2)./sum(dP.^2));
%R2St=1-(sum(nSt.^2)./sum(dSt.^2));;

subplot(1,1,1);
plot(t,CO2fit,'r-',t,dataCO2,'b-');
title('Production of CO2');
xlabel('time (h)');
ylabel('CO2 (kg/kgTM)');
